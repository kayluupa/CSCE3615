<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apartment Details - AptMate</title>
    <link rel="stylesheet" href="navbar/navbar.css">
    <link rel="stylesheet" href="apartment-details.css">
</head>
<body>
    <div id="navbar-container"></div>

    <div class="apartment-details-container">
        <h1 id="apartmentTitle">Apartment Details</h1>
        <div id="apartmentPhotos" class="apartment-photos">
            <button id="prevPhoto" class="carousel-button">❮</button>
            <div id="photoContainer" class="photo-container">
                <!-- Apartment photos will be dynamically inserted here -->
            </div>
            <button id="nextPhoto" class="carousel-button">❯</button>
        </div>
        <div id="apartmentDetails" class="apartment-details">
            <!-- Apartment details will be dynamically inserted here -->
        </div>
    </div>

    <script type="module">
        import { fetchApartmentData } from './database.js';
    
        async function displayApartmentDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const apartmentId = urlParams.get('id');
            console.log(`Apartment ID from URL: ${apartmentId}`); // Added debug log
            const apartmentDetails = await fetchApartmentData(apartmentId);
    
            if (apartmentDetails) {
                document.getElementById('apartmentTitle').innerText = `${apartmentId}`;
                
                const photoContainer = document.getElementById('photoContainer');
                const photos = apartmentDetails.Photos || [];
                photos.forEach((photoUrl, index) => {
                    const img = document.createElement('img');
                    img.src = photoUrl;
                    img.alt = `Apartment Photo ${index + 1}`;
                    img.className = "apartment-photo";
                    img.style.display = index === 0 ? 'block' : 'none'; // Show only the first photo initially
                    photoContainer.appendChild(img);
                });

                let currentIndex = 0;
                const totalPhotos = photos.length;

                document.getElementById('prevPhoto').addEventListener('click', () => {
                    if (totalPhotos > 1) {
                        photoContainer.children[currentIndex].style.display = 'none';
                        currentIndex = (currentIndex - 1 + totalPhotos) % totalPhotos;
                        photoContainer.children[currentIndex].style.display = 'block';
                    }
                });

                document.getElementById('nextPhoto').addEventListener('click', () => {
                    if (totalPhotos > 1) {
                        photoContainer.children[currentIndex].style.display = 'none';
                        currentIndex = (currentIndex + 1) % totalPhotos;
                        photoContainer.children[currentIndex].style.display = 'block';
                    }
                });
    
                const detailsContainer = document.getElementById('apartmentDetails');
                const amenities = Array.isArray(apartmentDetails.Amenities)
                    ? apartmentDetails.Amenities.join(', ')
                    : apartmentDetails.Amenities;
                detailsContainer.innerHTML = `
                    <div class="detail-item"><span class="detail-label">Price:</span> $${apartmentDetails.Price}</div>
                    <div class="detail-item"><span class="detail-label">Bedrooms:</span> ${apartmentDetails.Bedroom}</div>
                    <div class="detail-item"><span class="detail-label">Bathrooms:</span> ${apartmentDetails.Bathroom}</div>
                    <div class="detail-item"><span class="detail-label">Zip Code:</span> ${apartmentDetails.ZipCode}</div>
                    <div class="detail-item"><span class="detail-label">Amenities:</span> ${amenities}</div>
                    <div class="detail-item"><span class="detail-label">Website:</span> <a href="${apartmentDetails.Website}" target="_blank">Visit Site</a></div>
                `;
            } else {
                console.log('No apartment details found.');
            }
        }
    
        window.onload = displayApartmentDetails;
    </script>
    <script type="module" src="navbar/navbar.js"></script>
</body>
</html>
